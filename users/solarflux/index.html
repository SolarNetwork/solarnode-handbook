
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://solarnetwork.github.io/solarnode-handbook/users/solarflux/" rel="canonical"/>
<link href="../datum-filters/virtual-meter/" rel="prev"/>
<link href="../sysadmin/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.23" name="generator"/>
<title>SolarFlux - SolarNode Handbook</title>
<link href="../../assets/stylesheets/main.6543a935.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../css/sn.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="amber" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#solarflux">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="SolarNode Handbook" class="md-header__button md-logo" data-md-component="logo" href="../.." title="SolarNode Handbook">
<img alt="logo" src="../../images/solarnode-icon.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            SolarNode Handbook
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              SolarFlux
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="amber" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="amber" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="SolarNode Handbook" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="SolarNode Handbook">
<img alt="logo" src="../../images/solarnode-icon.svg"/>
</a>
    SolarNode Handbook
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    User Guide
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../getting-started/">
<span class="md-ellipsis">
    Getting Started
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../setup-app/">
<span class="md-ellipsis">
    Setup App
  </span>
</a>
<label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_3">
<span class="md-nav__icon md-icon"></span>
            Setup App
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/login/">
<span class="md-ellipsis">
    Login
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/home/">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_3_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../setup-app/settings/">
<span class="md-ellipsis">
    Settings
  </span>
</a>
<label class="md-nav__link" for="__nav_1_3_4" id="__nav_1_3_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_1_3_4">
<span class="md-nav__icon md-icon"></span>
            Settings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/components/">
<span class="md-ellipsis">
    Components
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/services/">
<span class="md-ellipsis">
    Services
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/datum-filters/">
<span class="md-ellipsis">
    Datum Filters
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/datum-sources/">
<span class="md-ellipsis">
    Datum Sources
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/logging/">
<span class="md-ellipsis">
    Logging
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/op-modes/">
<span class="md-ellipsis">
    Operational Modes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/settings/backups/">
<span class="md-ellipsis">
    Backups
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_3_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../setup-app/system/">
<span class="md-ellipsis">
    System
  </span>
</a>
<label class="md-nav__link" for="__nav_1_3_5" id="__nav_1_3_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_1_3_5">
<span class="md-nav__icon md-icon"></span>
            System
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/system/certificates/">
<span class="md-ellipsis">
    Certificates
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/system/packages/">
<span class="md-ellipsis">
    Packages
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/system/host-aliases/">
<span class="md-ellipsis">
    Host Aliases
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/system/restart/">
<span class="md-ellipsis">
    Restart
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/system/reset/">
<span class="md-ellipsis">
    Reset
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_3_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../setup-app/tools/">
<span class="md-ellipsis">
    Tools
  </span>
</a>
<label class="md-nav__link" for="__nav_1_3_6" id="__nav_1_3_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_3_6_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_1_3_6">
<span class="md-nav__icon md-icon"></span>
            Tools
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/tools/controls/">
<span class="md-ellipsis">
    Controls
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/tools/command-console/">
<span class="md-ellipsis">
    Command Console
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/tools/metrics/">
<span class="md-ellipsis">
    Metrics
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup-app/profile/">
<span class="md-ellipsis">
    Profile
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum/">
<span class="md-ellipsis">
    Datum
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../datum-filters/">
<span class="md-ellipsis">
    Datum Filters
  </span>
</a>
<label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_5">
<span class="md-nav__icon md-icon"></span>
            Datum Filters
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/chain/">
<span class="md-ellipsis">
    Filter Chain
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/control-updater/">
<span class="md-ellipsis">
    Control Updater
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/downsample/">
<span class="md-ellipsis">
    Downsample
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/expression/">
<span class="md-ellipsis">
    Expression
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/join/">
<span class="md-ellipsis">
    Join
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/metric-harvester/">
<span class="md-ellipsis">
    Metric Harvester
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/op-mode/">
<span class="md-ellipsis">
    Operational Mode
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/parameter-expression/">
<span class="md-ellipsis">
    Parameter Expression
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/property/">
<span class="md-ellipsis">
    Property
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/pvlib/">
<span class="md-ellipsis">
    POAI Calculator
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/split/">
<span class="md-ellipsis">
    Split
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/tariff/">
<span class="md-ellipsis">
    Tariff
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/throttle/">
<span class="md-ellipsis">
    Throttle
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/unchanged-property/">
<span class="md-ellipsis">
    Unchanged Property
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/unchanged/">
<span class="md-ellipsis">
    Unchanged
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../datum-filters/virtual-meter/">
<span class="md-ellipsis">
    Virtual Meter
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    SolarFlux
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    SolarFlux
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#solarflux-upload-service">
<span class="md-ellipsis">
      SolarFlux Upload Service
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mqtt-message-format">
<span class="md-ellipsis">
      MQTT message format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mqtt-message-topics">
<span class="md-ellipsis">
      MQTT message topics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream">
<span class="md-ellipsis">
      Log datum stream
    </span>
</a>
<nav aria-label="Log datum stream" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream-topic-mapping">
<span class="md-ellipsis">
      Log datum stream topic mapping
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream-properties">
<span class="md-ellipsis">
      Log datum stream properties
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#settings">
<span class="md-ellipsis">
      Settings
    </span>
</a>
<nav aria-label="Settings" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#filter-settings">
<span class="md-ellipsis">
      Filter settings
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#offline-message-persistence">
<span class="md-ellipsis">
      Offline message persistence
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../sysadmin/">
<span class="md-ellipsis">
    System Administration
  </span>
</a>
<label class="md-nav__link" for="__nav_1_7" id="__nav_1_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_7">
<span class="md-nav__icon md-icon"></span>
            System Administration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sysadmin/date-time/">
<span class="md-ellipsis">
    Date and Time
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sysadmin/networking/">
<span class="md-ellipsis">
    Networking
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sysadmin/packages/">
<span class="md-ellipsis">
    Package Maintenance
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sysadmin/solarnode-service/">
<span class="md-ellipsis">
    SolarNode Service
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sysadmin/solarssh/">
<span class="md-ellipsis">
    SolarSSH
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../networking/">
<span class="md-ellipsis">
    Networking
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../security-tokens/">
<span class="md-ellipsis">
    Security Tokens
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../remote-access/">
<span class="md-ellipsis">
    Remote Access
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../expressions/">
<span class="md-ellipsis">
    Expressions
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../metrics/">
<span class="md-ellipsis">
    Metrics
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../op-modes/">
<span class="md-ellipsis">
    Operational Modes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../placeholders/">
<span class="md-ellipsis">
    Placeholders
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configuration/">
<span class="md-ellipsis">
    Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../settings/">
<span class="md-ellipsis">
    Settings Files
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../logging/">
<span class="md-ellipsis">
    Logging
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../developers/">
<span class="md-ellipsis">
    Developer Guide
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../developers/osgi/">
<span class="md-ellipsis">
    Plugins
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/osgi/manifest/">
<span class="md-ellipsis">
    Manifest
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/osgi/life-cycle/">
<span class="md-ellipsis">
    Life cycle
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/osgi/configuration-admin/">
<span class="md-ellipsis">
    Configuration Admin
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/osgi/blueprint/">
<span class="md-ellipsis">
    Blueprint
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/osgi/blueprint-compendium/">
<span class="md-ellipsis">
    Blueprint Compendium
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../developers/settings/">
<span class="md-ellipsis">
    Settings
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            Settings
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/settings/provider/">
<span class="md-ellipsis">
    Settings Provider
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/settings/specifier/">
<span class="md-ellipsis">
    Setting Specifier
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/settings/resource-handler/">
<span class="md-ellipsis">
    Setting Resource Handler
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/settings/singleton/">
<span class="md-ellipsis">
    Singleton Service
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/settings/factory/">
<span class="md-ellipsis">
    Factory Service
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    Services
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            Services
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/backup-manager/">
<span class="md-ellipsis">
    Backup Manager
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/closeable-service/">
<span class="md-ellipsis">
    Closeable Service
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/datum-data-source-poll-job/">
<span class="md-ellipsis">
    Datum Data Source Poll Job
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/datum-data-source/">
<span class="md-ellipsis">
    Datum Data Source
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/datum-db/">
<span class="md-ellipsis">
    Datum Database
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/datum-queue/">
<span class="md-ellipsis">
    Datum Queue
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/job-scheduler/">
<span class="md-ellipsis">
    Job Scheduler
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/placeholder-service/">
<span class="md-ellipsis">
    Placeholder Service
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/settings-db/">
<span class="md-ellipsis">
    Settings Database
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/settings-service/">
<span class="md-ellipsis">
    Settings Service
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/sql-database/">
<span class="md-ellipsis">
    SQL Database
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/task-executor/">
<span class="md-ellipsis">
    Task Executor
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../developers/services/task-scheduler/">
<span class="md-ellipsis">
    Task Scheduler
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#solarflux-upload-service">
<span class="md-ellipsis">
      SolarFlux Upload Service
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mqtt-message-format">
<span class="md-ellipsis">
      MQTT message format
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mqtt-message-topics">
<span class="md-ellipsis">
      MQTT message topics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream">
<span class="md-ellipsis">
      Log datum stream
    </span>
</a>
<nav aria-label="Log datum stream" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream-topic-mapping">
<span class="md-ellipsis">
      Log datum stream topic mapping
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#log-datum-stream-properties">
<span class="md-ellipsis">
      Log datum stream properties
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#settings">
<span class="md-ellipsis">
      Settings
    </span>
</a>
<nav aria-label="Settings" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#filter-settings">
<span class="md-ellipsis">
      Filter settings
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#offline-message-persistence">
<span class="md-ellipsis">
      Offline message persistence
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="solarflux"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.</span> SolarFlux<a class="headerlink" href="#solarflux" title="Permanent link">¶</a></h1>
<p>SolarFlux is the name of a real-time cloud-based service for <a href="../datum/">datum</a> using a
publish/subscribe integration model. SolarNode supports publishing datum to SolarFlux and your own
applications can subscribe to receive datum messages as they are published.</p>
<p>SolarFlux is based on <a href="https://mqtt.org/">MQTT</a>. To integrate with SolarFlux you use a MQTT client application or library.
See the <a href="https://github.com/SolarNetwork/solarnetwork/wiki/SolarFlux-API#subscribing">SolarFlux Integration Guide</a> for more information.</p>
<h2 id="solarflux-upload-service"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.1</span> SolarFlux Upload Service<a class="headerlink" href="#solarflux-upload-service" title="Permanent link">¶</a></h2>
<p>SolarNode provides the <a href="https://github.com/SolarNetwork/solarnetwork-node/tree/develop/net.solarnetwork.node.upload.flux">SolarFlux Upload Service</a> plugin that posts datum captured by
SolarNode plugins to SolarFlux.</p>
<h2 id="mqtt-message-format"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.2</span> MQTT message format<a class="headerlink" href="#mqtt-message-format" title="Permanent link">¶</a></h2>
<p>Each datum message is published as a <a href="http://cbor.io/">CBOR</a> encoded map by default, to a <a href="#mqtt-message-topics">MQTT
topic</a> based on the datum's <strong>source ID</strong>. This is essentially a JSON object.
The map keys are the datum property names. You can configure a <strong>Datum Encoder</strong> to encode datum
into a different format, by configuring a <a href="#filter-settings">filter</a>. For example, the <a href="https://github.com/SolarNetwork/solarnetwork-node/tree/develop/net.solarnetwork.node.io.protobuf#protobuf-datum-encoderdecoder">Protobuf
Datum Encoder</a> supports encoding datum into Protobuf messages.</p>
<p>Messages are published with the MQTT <code>retained</code> flag set by default, which means the most recently
published datum is saved by SolarFlux. When an application subscribes to a topic it will immediately
receive any retained message for that topic. In this way, SolarFlux will provide a "most recent"
snapshot of all datum across all nodes and sources.</p>
<div class="highlight"><span class="filename">Example SolarFlux datum message, expressed as JSON</span><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"_DatumType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"net.solarnetwork.node.domain.ACEnergyDatum"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"_DatumTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">"net.solarnetwork.node.domain.ACEnergyDatum"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"net.solarnetwork.node.domain.EnergyDatum"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"net.solarnetwork.node.domain.Datum"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"net.solarnetwork.node.domain.GeneralDatum"</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"apparentPower"</span><span class="p">:</span><span class="w"> </span><span class="mi">2797</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"created"</span><span class="p">:</span><span class="w"> </span><span class="mi">1545167905344</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"current"</span><span class="p">:</span><span class="w"> </span><span class="mf">11.800409317016602</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"phase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PhaseB"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"phaseVoltage"</span><span class="p">:</span><span class="w"> </span><span class="mf">409.89337158203125</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"powerFactor"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2999000549316406</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"reactivePower"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1996</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"realPower"</span><span class="p">:</span><span class="w"> </span><span class="mi">1958</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"sourceId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ph2"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"voltage"</span><span class="p">:</span><span class="w"> </span><span class="mf">236.9553680419922</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"watts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1958</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="mqtt-message-topics"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.3</span> MQTT message topics<a class="headerlink" href="#mqtt-message-topics" title="Permanent link">¶</a></h2>
<p>The MQTT topic each datum is published to is derived from the node ID and datum source ID, according to this pattern:</p>
<div class="highlight"><pre><span></span><code>node/N/datum/A/S
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left;">Pattern Element</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>N</code></td>
<td style="text-align: left;">The <strong>node ID</strong> the datum was captured on</td>
</tr>
<tr>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;">An <strong>aggregation key</strong>; will be <code>0</code> for the "raw" datum captured in SolarNode</td>
</tr>
<tr>
<td style="text-align: left;"><code>S</code></td>
<td style="text-align: left;">The datum <strong>source ID</strong>; note that any leading <code>/</code> in the source ID is stripped from the topic</td>
</tr>
</tbody>
</table>
<div class="highlight"><span class="filename">Example MQTT topics</span><pre><span></span><code>node/1/datum/0/Meter
node/2/datum/0/Building1/Room1/Light1
node/2/datum/0/Building1/Room1/Light2
</code></pre></div>
<h2 id="log-datum-stream"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.4</span> Log datum stream<a class="headerlink" href="#log-datum-stream" title="Permanent link">¶</a></h2>
<p>The <a href="https://github.com/SolarNetwork/solarnetwork-common/tree/develop/net.solarnetwork.common.log4j2#eventadmin-appender"><code>EventAdmin</code> Appender</a> is supported, and <a href="../logging/">log events</a> are turned into a datum
stream and published to SolarFlux. The log timestamps are used as the datum timestamps.</p>
<h3 id="log-datum-stream-topic-mapping"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.4.1</span> Log datum stream topic mapping<a class="headerlink" href="#log-datum-stream-topic-mapping" title="Permanent link">¶</a></h3>
<p>The topic assigned to log events is <code>log/</code> with the log name appended. Period characters (<code>.</code>) in
the log name are replaced with slash characters (<code>/</code>). For example, a log name
<code>net.solarnetwork.node.datum.modbus.ModbusDatumDataSource</code> will be turned into the topic
<code>log/net/solarnetwork/node/datum/modbus/ModbusDatumDataSource</code>.</p>
<h3 id="log-datum-stream-properties"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.4.2</span> Log datum stream properties<a class="headerlink" href="#log-datum-stream-properties" title="Permanent link">¶</a></h3>
<p>The datum stream consists of the following properties:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Property</th>
<th style="text-align: left;">Class.</th>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>level</code></td>
<td style="text-align: left;"><code>s</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: left;">The log level name, e.g. <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, or <code>FATAL</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>priority</code></td>
<td style="text-align: left;"><code>i</code></td>
<td style="text-align: left;">Integer</td>
<td style="text-align: left;">The log level priority (lower values have more priority), e.g. <code>600</code>, <code>500</code>, <code>400</code>, <code>300</code>, <code>200</code>, or <code>100</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>name</code></td>
<td style="text-align: left;"><code>s</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: left;">The log name.</td>
</tr>
<tr>
<td style="text-align: left;"><code>msg</code></td>
<td style="text-align: left;"><code>s</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: left;">The log message .</td>
</tr>
<tr>
<td style="text-align: left;"><code>exMsg</code></td>
<td style="text-align: left;"><code>s</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: left;">An exception message, if an exception was included.</td>
</tr>
<tr>
<td style="text-align: left;"><code>exSt</code></td>
<td style="text-align: left;"><code>s</code></td>
<td style="text-align: left;">String</td>
<td style="text-align: left;">A newline-delimited list of stack trace element values, if an exception was included.</td>
</tr>
</tbody>
</table>
<h2 id="settings"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.5</span> Settings<a class="headerlink" href="#settings" title="Permanent link">¶</a></h2>
<p>The SolarFlux Upload Service ships with default settings that work out-of-the-box without any
configuration. There are many settings you can change to better suit your needs, however.</p>
<figure>
<p><img alt="SolarFlux main settings" loading="lazy" src="../../images/users/solarflux-upload-service-settings%402x.png" width="550"/></p>
</figure>
<p>Each component configuration contains the following overall settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Host</td>
<td>The URI for the SolarFlux server to connect to. Normally this is <code>influx.solarnetwork.net:8884</code>.</td>
</tr>
<tr>
<td>Username</td>
<td>The MQTT username to use. Normally this is <code>solarnode</code>.</td>
</tr>
<tr>
<td>Password</td>
<td>The MQTT password to use. Normally this is not needed as the node's certificate it used for authentication.</td>
</tr>
<tr>
<td>Exclude Properties</td>
<td>A regular expression to match property names on all datum sources to exclude from publishing.</td>
</tr>
<tr>
<td>Required Mode</td>
<td>If configured, an <a href="../op-modes/">operational mode</a> that must be active for any data to be published.</td>
</tr>
<tr>
<td>Maximum Republish</td>
<td>If offline message persistence has been configured, then the maximum number of offline messages to publish in one go. See the <a href="#offline-message-persistence">offline persistence</a> section for more information.</td>
</tr>
<tr>
<td>Reliability</td>
<td>The MQTT <em>quality of service</em> level to use. Normally the default of <strong>At most once</strong> is sufficient.</td>
</tr>
<tr>
<td>Version</td>
<td>The MQTT protocol version to use. Startig with version 5 MQTT <a href="https://www.hivemq.com/blog/mqtt5-essentials-part10-topic-alias/">topic aliases</a> will be used if the server supports it, which can save a significant amount of network bandwidth when long source IDs are in use.</td>
</tr>
<tr>
<td>Retained</td>
<td>Toggle the MQTT <em>retained</em> message flag. When enabled the MQTT server will store the most recently published message on each topic so it is immediately available when clients connect.</td>
</tr>
<tr>
<td>Wire Logging</td>
<td>Toggle verbose logging on/off to support troubleshooting. The messages are logged to the <code>net.solarnetwork.mqtt</code> topic at <code>DEBUG</code> level.</td>
</tr>
<tr>
<td>Filters</td>
<td>Any number of datum <a href="#filter-settings">filter configurations</a>.</td>
</tr>
</tbody>
</table>
<p>For TLS-encrypted connections, SolarNode will make the node's own X.509 certificate available for
client authentication.</p>
<h3 id="filter-settings"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.5.1</span> Filter settings<a class="headerlink" href="#filter-settings" title="Permanent link">¶</a></h3>
<p>Each component can define any number of filters, which are used to manipulate the datum published to SolarFlux,
such as:</p>
<ul>
<li>restrict the frequency at which individual datum sources are published</li>
<li>restrict which properties of datum are posted</li>
<li>encode the message into something other than CBOR</li>
</ul>
<p>The filter settings can be very useful to constrain how much data is sent to SolarFlux, for example
on nodes using mobile internet connections where the cost of posting data is high.</p>
<figure>
<p><img alt="SolarFlux filter settings" loading="lazy" src="../../images/users/solarflux-upload-service-filter-settings%402x.png" width="563"/></p>
</figure>
<p>A filter can configure a <strong>Datum Encoder</strong> to encode the MQTT message with, if you want to use a
format other than the default CBOR encoding. This can be combined with a <strong>Source ID</strong> pattern to
encode specific sources with specific encoders. For example when using the <a href="https://github.com/SolarNetwork/solarnetwork-node/tree/develop/net.solarnetwork.node.io.protobuf#protobuf-datum-encoderdecoder">Protobuf Datum
Encoder</a> a single Protobuf message type is supported per encoder. If you want to encode
different datum sources into different Protobuf messages, you would configure one encoder per
message type, and then one filter per source ID with the corresponding encoder.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All filters are applied in the order they are defined, and then the <em>first</em> filter with a
<strong>Datum Encoder</strong> configured that matches the filter's <strong>Source ID</strong> pattern will be used to
encode the datum. If not Datum Encoder is configured the default CBOR encoding will be used.</p>
</div>
<p>Each filter configuration contains the following settings:</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source ID</td>
<td>A case-insensitive regular expression to match against datum source IDs. If defined, this filter will only be applied to datum with matching source ID values. If not defined this filter will be applied to all datum. For example <code>^solar</code> would match any source ID starting with <em>solar</em>.</td>
</tr>
<tr>
<td>Datum Filter</td>
<td>The <strong>Service Name</strong> of a <a href="../datum-filters/">Datum Filter</a> component to apply before encoding and posting datum.</td>
</tr>
<tr>
<td>Required Mode</td>
<td>If configured, an <a href="../op-modes/">operational mode</a> that must be active for this filter to be applied.</td>
</tr>
<tr>
<td>Datum Encoder</td>
<td>The <strong>Service Name</strong> if a <strong>Datum Encoder</strong> component to encode datum with. The encoder will be passed a <code>java.util.Map</code> object with all the datum properties. If not configured then CBOR will be used.</td>
</tr>
<tr>
<td>Limit Seconds</td>
<td>The minimum number of seconds to limit datum that match the configured <strong>Source ID</strong> pattern. If datum are produced faster than this rate, they will be filtered out. Set to <code>0</code> or leave empty for no limit.</td>
</tr>
<tr>
<td>Property Includes</td>
<td>A list of  case-insensitive regular expressions to match against datum property names. If configured, <strong>only</strong> properties that match one of these expressions will be included in the filtered output. For example <code>^watt</code> would match any property starting with <em>watt</em>.</td>
</tr>
<tr>
<td>Property Excludes</td>
<td>A list of  case-insensitive regular expressions to match against datum property names. If configured, <strong>any</strong> property that match one of these expressions will be excluded from the filtered output. For example <code>^temp</code> would match any property starting with <em>temp</em>. Exclusions are applied <strong>after</strong> property inclusions.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The datum <code>sourceId</code> and <code>created</code> properties will be affected by the property include/exclude
filters! If you define <strong>any</strong> include filters, you might want to add an include rule for
<code>^created$</code>. You might like to have <code>sourceId</code> removed to conserve bandwidth, given that value
is part of the MQTT topic the datum is posted on and thus redundant.</p>
</div>
<h2 id="offline-message-persistence"><span class="enumerate-headings-plugin enumerate-heading-plugin">43.6</span> Offline message persistence<a class="headerlink" href="#offline-message-persistence" title="Permanent link">¶</a></h2>
<p>By default if the connection to the SolarFlux server is down for any reason, all messages that would
normally be published to the server will be discarded. This is suitable for most applications that
rely on SolarFlux to view real-time status updates only, and SolarNode uploads datum to SolarNet for
long-term persistence. For applications that rely on SolarFlux for more, it might be desirable to
configure SolarNode to locally cache SolarFlux messages when the connection is down, and then
publish those cached messages when the connection is restored. This can be accomplished by deploying
the <a href="https://github.com/SolarNetwork/solarnetwork-node/tree/develop/net.solarnetwork.node.dao.mqtt.jdbc">MQTT Persistence</a> plugin.</p>
<p>When that plugin is available, all messages processed by this service will be saved locally when the
MQTT connection is down, and then posted once the MQTT connection comes back up. Note the following
points to consider:</p>
<ul>
<li>The cached messages will be posted with the MQTT <em>retained</em> flag set to <code>false</code>.</li>
<li>The cached messages will be posted in an unspecified order.</li>
<li>The cached messages may be posted more than once, regardless of the configured <em>Reliabiliy</em>
   setting.</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.instant", "navigation.path", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.ebd0bdb7.min.js"></script>
<script src="../../js/open_in_new_tab.js"></script>
</body>
</html>